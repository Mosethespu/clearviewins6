{% extends "base.html" %}

{% block title %}Request Renewal - {{ policy.policy_number }} - ClearView Insurance{% endblock %}

{% block content %}
<div class="container-fluid py-4">
	<div class="row">
		<!-- Sidebar -->
		<aside class="col-12 col-md-3 col-lg-2 mb-4 mb-md-0">
			<div class="dashboard-sidebar p-3 bg-light rounded shadow-sm">
				<h6 class="text-uppercase text-muted mb-3">User Options</h6>
				<div class="d-grid gap-2">
					<a class="btn btn-outline-primary sidebar-btn" href="{{ url_for('customer_dashboard') }}">
						<i class="bi bi-house"></i> Dashboard
					</a>
					<a class="btn btn-outline-primary sidebar-btn" href="{{ url_for('customer_search') }}">
						<i class="bi bi-search"></i> Search
					</a>
					<a class="btn btn-primary sidebar-btn" href="{{ url_for('customer_policy_management') }}">
						<i class="bi bi-shield-check"></i> Policy Management
					</a>
					<a class="btn btn-outline-primary sidebar-btn" href="{{ url_for('customer_search_vehicle') }}">
						<i class="bi bi-car-front"></i> Search Vehicle
					</a>
					<a class="btn btn-outline-primary sidebar-btn" href="{{ url_for('customer_reports_and_insights') }}">
						<i class="bi bi-graph-up"></i> Reports & Insights
					</a>
				</div>
			</div>
		</aside>

		<!-- Main content -->
		<main class="col-12 col-md-9 col-lg-10">
			<div class="px-2 px-md-3">
				<!-- Header -->
				<div class="d-flex justify-content-between align-items-center mb-4">
					<div>
						<h2><i class="bi bi-arrow-clockwise text-success"></i> Request Policy Renewal</h2>
						<p class="text-muted mb-0">Renew {{ policy.policy_number }} for another year</p>
					</div>
					<div>
						<a href="{{ url_for('customer_policy_management') }}" class="btn btn-outline-secondary">
							<i class="bi bi-arrow-left"></i> Cancel
						</a>
					</div>
				</div>

				<div class="row justify-content-center">
					<div class="col-lg-8">
						<!-- Policy Status Alert -->
						<div class="alert alert-warning">
							<h5 class="alert-heading"><i class="bi bi-clock-history"></i> Policy Expiring Soon</h5>
							<p class="mb-0">
								Your policy expires in <strong>{{ days_until_expiry }} day(s)</strong> on 
								<strong>{{ policy.expiry_date.strftime('%d %B %Y') }}</strong>. 
								Submit a renewal request to continue your coverage.
							</p>
						</div>

						<!-- Current Policy Details -->
						<div class="card shadow-sm mb-4">
							<div class="card-header bg-primary text-white">
								<h5 class="mb-0"><i class="bi bi-file-text"></i> Current Policy Details</h5>
							</div>
							<div class="card-body">
								<div class="row">
									<div class="col-md-6">
										<p><strong>Policy Number:</strong> {{ policy.policy_number }}</p>
										<p><strong>Vehicle:</strong> {{ policy.registration_number }} - {{ policy.make_model }}</p>
										<p><strong>Policy Type:</strong> {{ policy.policy_type }}</p>
										<p><strong>Current Premium:</strong> <span class="text-success">KES {{ "{:,.2f}".format(policy.premium_amount) }}</span></p>
									</div>
									<div class="col-md-6">
										<p><strong>Insurance Company:</strong> {{ policy.insurance_company.name if policy.insurance_company else 'N/A' }}</p>
										<p><strong>Current Start Date:</strong> {{ policy.effective_date.strftime('%d %b %Y') if policy.effective_date else 'N/A' }}</p>
										<p><strong>Current Expiry Date:</strong> {{ policy.expiry_date.strftime('%d %b %Y') if policy.expiry_date else 'N/A' }}</p>
										<p><strong>Status:</strong> <span class="badge bg-success">{{ policy.status }}</span></p>
									</div>
								</div>
							</div>
						</div>

						<!-- Renewal Details -->
						<div class="card shadow-sm mb-4">
							<div class="card-header bg-success text-white">
								<h5 class="mb-0"><i class="bi bi-calendar-check"></i> Proposed Renewal Dates</h5>
							</div>
							<div class="card-body">
								<div class="row">
									<div class="col-md-6">
										<div class="d-flex align-items-center mb-3">
											<div class="me-3">
												<i class="bi bi-calendar2-check text-success" style="font-size: 2rem;"></i>
											</div>
											<div>
												<small class="text-muted">New Start Date</small>
												<h5 class="mb-0">{{ new_effective_date.strftime('%d %B %Y') }}</h5>
											</div>
										</div>
									</div>
									<div class="col-md-6">
										<div class="d-flex align-items-center mb-3">
											<div class="me-3">
												<i class="bi bi-calendar2-x text-warning" style="font-size: 2rem;"></i>
											</div>
											<div>
												<small class="text-muted">New Expiry Date</small>
												<h5 class="mb-0">{{ new_expiry_date.strftime('%d %B %Y') }}</h5>
											</div>
										</div>
									</div>
								</div>

								<div class="alert alert-info mt-3 mb-0">
									<i class="bi bi-info-circle"></i>
									<strong>Coverage Period:</strong> 365 days (1 year) from {{ new_effective_date.strftime('%d %b %Y') }} to {{ new_expiry_date.strftime('%d %b %Y') }}
								</div>
							</div>
						</div>

						<!-- Submit Renewal -->
						<div class="card shadow-sm mb-4">
							<div class="card-header bg-success text-white">
								<h5 class="mb-0"><i class="bi bi-send"></i> Submit Renewal Request</h5>
							</div>
							<div class="card-body">
								<form method="POST">
									<div class="alert alert-info">
										<i class="bi bi-info-circle"></i>
										<strong>What happens next?</strong>
										<ul class="mb-0 mt-2">
											<li>Your renewal request will be sent to {{ policy.insurance_company.name if policy.insurance_company else 'the insurer' }}</li>
											<li>The insurer will review and may adjust the premium based on current rates</li>
											<li>If approved, your policy will be automatically renewed with the new dates</li>
											<li>You will be notified of the final premium amount and approval status</li>
											<li>Payment instructions will be provided upon approval</li>
										</ul>
									</div>

									<div class="bg-light p-3 rounded mb-3">
										<h6><i class="bi bi-cash-stack"></i> Premium Information</h6>
										<p class="mb-2">
											<strong>Current Premium:</strong> KES {{ "{:,.2f}".format(policy.premium_amount) }}<br>
											<small class="text-muted">The final renewal premium will be confirmed by the insurer and may differ based on current rates, vehicle age, and claims history.</small>
										</p>
									</div>

									<div class="form-check mb-4">
										<input class="form-check-input" type="checkbox" id="confirm" required>
										<label class="form-check-label" for="confirm">
											I understand that the renewal is subject to insurer approval and the final premium may be adjusted.
										</label>
									</div>

									<div class="d-grid gap-2">
										<button type="submit" class="btn btn-success btn-lg">
											<i class="bi bi-arrow-clockwise"></i> Submit Renewal Request
										</button>
										<a href="{{ url_for('customer_policy_management') }}" class="btn btn-outline-secondary">
											Cancel
										</a>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
		</main>
	</div>
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
{% endblock %}
