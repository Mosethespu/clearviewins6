{% extends "base.html" %}

{% block title %}Policy Found - {{ policy.policy_number }} - ClearView Insurance{% endblock %}

{% block content %}
<div class="container-fluid py-4">
	<div class="row">
		<!-- Sidebar -->
		<aside class="col-12 col-md-3 col-lg-2 mb-4 mb-md-0">
			<div class="dashboard-sidebar p-3 bg-light rounded shadow-sm">
				<h6 class="text-uppercase text-muted mb-3">User Options</h6>
				<div class="d-grid gap-2">
					<a class="btn btn-outline-primary sidebar-btn" href="{{ url_for('customer_dashboard') }}">
						<i class="bi bi-house"></i> Dashboard
					</a>
					<a class="btn btn-outline-primary sidebar-btn" href="{{ url_for('customer_search') }}">
						<i class="bi bi-search"></i> Search
					</a>
					<a class="btn btn-primary sidebar-btn" href="{{ url_for('customer_policy_management') }}">
						<i class="bi bi-shield-check"></i> Policy Management
					</a>
					<a class="btn btn-outline-primary sidebar-btn" href="{{ url_for('customer_search_vehicle') }}">
						<i class="bi bi-car-front"></i> Search Vehicle
					</a>
					<a class="btn btn-outline-primary sidebar-btn" href="{{ url_for('customer_reports_and_insights') }}">
						<i class="bi bi-graph-up"></i> Reports & Insights
					</a>
				</div>
			</div>
		</aside>

		<!-- Main content -->
		<main class="col-12 col-md-9 col-lg-10">
			<div class="px-2 px-md-3">
				<!-- Header -->
				<div class="d-flex justify-content-between align-items-center mb-4">
					<div>
						<h2><i class="bi bi-check-circle text-success"></i> Policy Found</h2>
						<p class="text-muted mb-0">{{ policy.policy_number }}</p>
					</div>
					<div>
						<a href="{{ url_for('customer_search_policy') }}" class="btn btn-outline-secondary">
							<i class="bi bi-search"></i> New Search
						</a>
					</div>
				</div>

				<!-- Policy Overview -->
				<div class="card shadow-sm mb-4">
					<div class="card-header bg-primary text-white">
						<h5 class="mb-0"><i class="bi bi-file-text"></i> Policy Information</h5>
					</div>
					<div class="card-body">
						<div class="row">
							<div class="col-md-6">
								<table class="table table-borderless mb-0">
									<tr>
										<th class="text-muted" style="width: 45%;">Policy Number:</th>
										<td><strong>{{ policy.policy_number }}</strong></td>
									</tr>
									<tr>
										<th class="text-muted">Insurance Company:</th>
										<td>{{ policy.insurance_company.name if policy.insurance_company else 'N/A' }}</td>
									</tr>
									<tr>
										<th class="text-muted">Policy Type:</th>
										<td>{{ policy.policy_type }}</td>
									</tr>
									<tr>
										<th class="text-muted">Status:</th>
										<td>
											{% if policy.status == 'Active' %}
												<span class="badge bg-success">{{ policy.status }}</span>
											{% elif policy.status == 'Expired' %}
												<span class="badge bg-secondary">{{ policy.status }}</span>
											{% else %}
												<span class="badge bg-danger">{{ policy.status }}</span>
											{% endif %}
										</td>
									</tr>
								</table>
							</div>
							<div class="col-md-6">
								<table class="table table-borderless mb-0">
									<tr>
										<th class="text-muted" style="width: 45%;">Vehicle:</th>
										<td><strong>{{ policy.registration_number }}</strong></td>
									</tr>
									<tr>
										<th class="text-muted">Make & Model:</th>
										<td>{{ policy.make_model }}</td>
									</tr>
									<tr>
										<th class="text-muted">Effective Date:</th>
										<td>{{ policy.effective_date.strftime('%d %b %Y') if policy.effective_date else 'N/A' }}</td>
									</tr>
									<tr>
										<th class="text-muted">Expiry Date:</th>
										<td>{{ policy.expiry_date.strftime('%d %b %Y') if policy.expiry_date else 'N/A' }}</td>
									</tr>
								</table>
							</div>
						</div>
					</div>
				</div>

				<!-- Actions Card -->
				<div class="card shadow-sm mb-4">
					<div class="card-header bg-success text-white">
						<h5 class="mb-0"><i class="bi bi-hand-pointer"></i> Available Actions</h5>
					</div>
					<div class="card-body">
						<div class="row g-3">
							<!-- Add to Monitor -->
							<div class="col-md-6">
								<div class="card h-100 {% if is_monitored %}border-success{% endif %}">
									<div class="card-body">
										<h5 class="card-title">
											<i class="bi bi-eye"></i> Monitor This Policy
										</h5>
										<p class="card-text">
											Add to your monitoring list for view-only access to track status and details.
										</p>
										{% if is_monitored %}
											<button class="btn btn-success" disabled>
												<i class="bi bi-check-circle"></i> Already Monitoring
											</button>
										{% else %}
											<form action="{{ url_for('customer_add_to_monitor', policy_id=policy.id) }}" method="POST">
												<button type="submit" class="btn btn-primary">
													<i class="bi bi-plus-circle"></i> Add to Monitor
												</button>
											</form>
										{% endif %}
									</div>
								</div>
							</div>

							<!-- Request Access -->
							<div class="col-md-6">
								<div class="card h-100 {% if has_pending_request %}border-warning{% endif %}">
									<div class="card-body">
										<h5 class="card-title">
											<i class="bi bi-key"></i> Request Full Access
										</h5>
										<p class="card-text">
											Submit a request to add this policy to your account (requires insurer approval).
										</p>
										{% if has_pending_request %}
											<button class="btn btn-warning" disabled>
												<i class="bi bi-hourglass-split"></i> Request Pending
											</button>
										{% else %}
											<a href="{{ url_for('customer_request_policy_access', policy_id=policy.id) }}" class="btn btn-success">
												<i class="bi bi-send"></i> Request Access
											</a>
										{% endif %}
									</div>
								</div>
							</div>
						</div>

						<!-- View Details Button -->
						<div class="mt-3 text-center">
							<a href="{{ url_for('customer_view_policy_from_management', policy_id=policy.id) }}" class="btn btn-outline-primary btn-lg">
								<i class="bi bi-eye"></i> View Full Details
							</a>
						</div>
					</div>
				</div>

				<!-- Info Alert -->
				<div class="alert alert-info">
					<i class="bi bi-info-circle"></i>
					<strong>Note:</strong> Monitoring allows view-only access. For full management capabilities (cancellation, renewal), you need to request access and have it approved by the insurer.
				</div>
			</div>
		</main>
	</div>
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
{% endblock %}
